services:
  # ── Production (static build served by 'serve') ────
  broxeen:
    build:
      context: .
      target: production
    ports:
      - "4173:4173"
    restart: unless-stopped
    environment:
      - NODE_ENV=production

  # ── Development (Vite dev server, hot reload) ──────
  broxeen-dev:
    build:
      context: .
      target: dev
    ports:
      - "5173:5173"
    volumes:
      - .:/app
      - /app/node_modules
    environment:
      - VITE_OPENROUTER_API_KEY=${VITE_OPENROUTER_API_KEY:-}
      - VITE_LLM_MODEL=${VITE_LLM_MODEL:-}
    profiles:
      - dev

  # ── Tests (vitest) ─────────────────────────────────
  broxeen-test:
    build:
      context: .
      target: test
    environment:
      - CI=true
    profiles:
      - test
